# Revoking a Key

Revoking an OpenPGP key means that we publish a statement saying that the
key should not be used anymore.  The statement may include why the key
shouldn't be used (e.g., it has been compromised, or the user simply has a
new one), and when it should come into effect.  The statement is a machine
readable, cryptographic artifact and is called a "revocation certificate".

Revocation certificates should be widely published (e.g., on Key Servers,
and in any WKD) so that third parties will quickly learn that the
key should not be used anymore, and to prevent an attacker from hindering
distribution of the revocation certificate.

There are different reasons why we might want to revoke a user's OpenPGP
key. For example, the user's key might have been compromised, or the user has
left our organization. Revocation certificates contain information about
the reason why the affected OpenPGP key has been revoked.

# Managing Revocations

In OpenPGP, to be able to generate a revocation certificate for a key,
the private part of that key is needed. This means that in the OpenPGP
paradigm, revocations can typically only be generated by the user themselves.

In OpenPGP CA, while we don't centrally store users' private keys, OpenPGP CA can 
store revocation certificates for our users' keys.
This means that the OpenPGP CA admin can choose to invalidate users' keys -
or, if the OpenPGP CA data, including the revocation certificates are
compromised, a third party is able to invalidate one or many user keys,
thus performing a kind of denial of service attack against our OpenPGP
usage.  But that type of attack is typically much less severe than one in
which the attacker gains access to the user's private key material.

For every user, one or many revocation certificates may be stored in OpenPGP
CA.

To check which revocation certificates exist for a given user, we can query
by email:

`$ openpgp-ca -d example.oca user show-revocations --email alice@example.org`

```
Revocations for Usercert "Alice Adams"
 - revocation id 90E28DFB6D501AB7: No reason specified (Unspecified) (15/07/2020)
```
The results show an ID for each individual revocation certificate.

When we've determined which revocation certificate we want to apply, we can
apply that revocation to the user's key:

`$ openpgp-ca -d example.oca user apply-revocation --id 90E28DFB6D501AB7`

Afterwards, "show-revocations" will display the additional note: "this
revocation has been PUBLISHED", and the user's public key contains the
revocation certificate:

`$ openpgp-ca -d example.oca user show-revocations --email alice@example.org`

```
Revocations for Usercert "Alice Adams"
 - revocation id 90E28DFB6D501AB7: No reason specified (Unspecified) (15/07/2020)
   this revocation has been APPLIED
```

# Publishing the revocation

Now the revocation has been applied to the user's certificate.
You still need to publish this newly revoked version of the user's
certificate. You can do this manually, by exporting the certificate

`$ openpgp-ca -d example.oca user export --email alice@example.org > alice.pub`
 
and then
[uploading it to a public key server](https://keys.openpgp.org/about/usage#gnupg-upload).

Alternatively (or additionally) you can
[regenerate your organization's WKD](keys-publish.md#publish-keys-as-a-wkd)
and publish the new version of this user certificate there.

As the revoked version of the user's key gets disseminated, the OpenPGP
implementations of third parties learn that the key should no longer be used.
