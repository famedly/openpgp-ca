# Centralized key creation workflow

User keys get generated by OpenPGP CA

## (1) OpenPGP CA:
### set up CA

*  Set environment variable to configure where the database is stored:
 
`export OPENPGP_CA_DB=/tmp/openpgp-ca.sqlite`

*  Set up a new CA instance and generate a new keypair for the CA:

`openpgp-ca ca init example.org` 

### create new user

`openpgp-ca user add --email alice@example.org --name "Alice Adams"`

The new user's private Key is shown as output of this command, but not
stored. It needs to be copied to the user's devices and imported into the
OpenPGP keystore there. We're going to paste the key into a file
`alice.privatekey` for this example.

### export CA public key

*  Export the CA public key, for use on client machines (the key is tsigned
 by Alice at this point):

`openpgp-ca ca export > ca.pubkey` 

## (2) on user machine using gpg: import CA public key, user private key

*  Set up a gpg test environment and import the CA public key:

`mkdir /tmp/test/`

`export GNUPGHOME=/tmp/test/`

* Import user private key

`gpg --import alice.privatekey`

* Set ownertrust for this key

`gpg --edit-key alice@example.org`

Then `trust`, `5`, `quit`.

* Import CA public key

`gpg --import ca.pubkey`

* gpg now shows the Key for alice with "ultimate" trust, and the ca Key
 with "full" trust:
 
`gpg --list-keys` 
